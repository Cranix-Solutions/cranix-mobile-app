<cranix-toolbar title="{{ 'Todos' | translate}}"></cranix-toolbar>
@if(selectedChallenge){
  <ion-toolbar class="page-toolbar">
    <ion-title>
      @if(selectedChallenge.teachingSubject){
        <b>{{selectedChallenge.teachingSubject.name}}:</b>
      }
      {{selectedChallenge.title}}
    </ion-title>
    <ion-buttons slot="end">
      <ion-button size="small" fill="solid" (click)="close(false)">
        <ion-icon slot="icon-only" name="close" color="danger"></ion-icon>
      </ion-button>
      <ion-popover #popover [isOpen]="isOpen" (didDismiss)="isOpen = false">
        <ng-template>
          <ion-content class="ion-padding">
            {{'Your changes will be lost if you close this window.' | translate}}<br>
            <ion-button size="small" fill="solid" (click)="close(true)">{{'Close'|translate}}</ion-button>
            <ion-button size="small" fill="solid" (click)="isOpen=false">{{'Abort'|translate}}</ion-button>
          </ion-content>
        </ng-template>
      </ion-popover>
      <ion-button *ngIf="!autoSave" size="small" fill="solid" (click)="autoSave = !autoSave"
        matTooltip="{{'Turn on auto save. All changes will be saved inmediately.' | translate }}">
        <ion-icon slot="icon-only" name="play" color="success"></ion-icon>
      </ion-button>
      <ion-button *ngIf="autoSave" size="small" fill="solid" (click)="autoSave = !autoSave"
        matTooltip="{{'Turn off auto save. Changes will be saved only by push the checkmark.' | translate }}">
        <ion-icon slot="icon-only" name="stop" color="danger"></ion-icon>
      </ion-button>
      <ion-button size="small" fill="solid" (click)="save(false)" matTooltip="{{'Save challenge' | translate }}"
        [disabled]="!challengesService.modified">
        <ion-icon slot="icon-only" name="checkmark" color="success"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-content>
    @for(question of selectedChallenge.questions; track question.id; let i = $index){
    <div class="question">
      <ion-item style="background-color: lightgray;">
        <div class="counter"><b>{{i+1}}</b></div>
        <div [innerHTML]="question.question"></div>
      </ion-item>
      <ion-item class="answer" *ngFor="let answer of question.crxQuestionAnswers; index as j">
        @switch (question.answerType) {
          @case ("One") {
          <input style="margin-right: 10px;" type="radio" name="answer-{{i}}-{{j}}" [checked]="answer.correct" (click)="toggle(i, j)">
          <div [innerHTML]="answer.answer"></div>
          }
          @case ("Multiple") {
          <input style="margin-right: 10px;" type="checkbox" name="answer-{{i}}-{{j}}" [checked]="answer.correct" (click)="toggle(i, j)">
          <div [innerHTML]="answer.answer"></div>
          }
          @case ("Text") {
          <input style="margin-right: 10px;" name="answer-{{i}}-{{j}}" [(ngModel)]="answer.answer" (onblur)="textChanged()">
          }
        }
      </ion-item>
    </div>
    }
  </ion-content>
}@else{
  <ion-toolbar class="page-toolbar">
    {{'Reload tests to work on' | translate}}
    <ion-buttons slot="end">
      <ion-button size="small" fill="solid" (click)="objectService.getAllObject('challenges/todo')">
        <ion-icon slot="icon-only" name="refresh" color="success"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-content>
    @for(object of objectService.allObjects['challenges/todo']; track object.id; let i = $index){
      <ion-item style="background-color : {{authService.rowColors[i%2]}}">
        <ion-label (click)="redirectToEdit(object)">
          @if(object.teachingSubject) {
            <b>{{object.teachingSubject.name}}:</b>
          } {{object.title}}
        </ion-label>
      </ion-item>
    }
  </ion-content>
}
